<!DOCTYPE html>
<html>
<head>
    <title>Мишкин house</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="publick/vendor/bower_components/bootstrap/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="publick/css/app.less">

</head>
<body>

<div class="container">
    <header class="row">
        <div class="col-md-3 logo">
            <div class="logo__top">мишкин</div>
            <div class="logo__btm">house</div>
        </div>
        <div class="col-md-6 slogan">"Мишкин HOUSE" - Bootstrap/Backbone.js demo app</div>
        <div class="col-md-3 contacts">
            <span class="glyphicon glyphicon-envelope"></span> admin@mishkin-house.ru<br/>
            <span class="glyphicon glyphicon-volume-up"></span> +7 123 456 78 90
        </div>
    </header>
    <div class="row">

        <div class="col-md-12">
            <!-- Nav tabs -->
            <div id="toy-types" class="nav nav-tabs">
                <a href="#bear" data-toggle="tab" class="btn btn-sm btn-border-gray btn-border-black col-md-3 col-xs-6 js-tab">Мишки</a>
                <a href="#minion" data-toggle="tab" class="btn btn-sm btn-border-gray col-md-3 col-xs-6 js-tab">Миньоны</a>
                <a href="#wood" data-toggle="tab" class="btn btn-sm btn-border-gray col-md-3 col-xs-6 js-tab">Бревна</a>
                <a href="#others" data-toggle="tab" class="btn btn-sm btn-border-gray col-md-3 col-xs-6 js-tab">Другие</a>
            </div>
        </div>

            <!-- Tab panes -->
        <div class="col-md-12">
            <div class="tab-content">

                <div class="tab-pane fade" id="bear">
                    <div class="toys js-bears">
                        <!-- template -->
                    </div>
                </div><!-- end tab item -->

                <div class="tab-pane fade in active" id="minion">
                    <div class="toys js-minion">

                    </div>
                </div><!-- end tab item -->

                <div class="tab-pane fade" id="wood">
                    Товары будут добавлены позже
                </div><!-- end tab item -->

                <div class="tab-pane fade" id="others">
                    Товары будут добавлены позже
                </div><!-- end tab item -->

            </div>
        </div>
    </div>
    <footer class="row">
        <div class="col-md-3">2014 г.</div>
        <div class="col-md-6">mishkin-house.ru | Купи мишку - подари радость!</div>
        <div class="col-md-3">admin@mishkin-house.ru</div>
    </footer>

</div> <!-- container -->

<!-- Modal -->
<div class="modal fade js-popup" id="order-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">

</div><!-- /.modal -->

<script type="text/template" id="submit-template">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel">Ваш заказ принят</h4>
            </div>
            <div class="modal-body">
                Ваш заказ принят, мы вам перезвоним на указанный номер: <%- order.phone %>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Закрыть</button>
            </div>
        </div>
    </div>
</script>

<script type="text/template" id="toy-template">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel">Подробнее о товаре</h4>
            </div>
            <div class="modal-body">
                <div class="modal-body__left">
                    <img src="<%- toy.img %>" alt="toy" class="modal-body__img">
                </div>
                <div class="modal-body__right">
                    <div class="info">
                        <div class="js-toy-wrapper">
                            <div class="info__item">Артикул: <span class="js-info-articul"><%- toy.code %></span></div>
                            <div class="info__item">Название: <span class="js-info-name"><%- toy.name %></span></div>
                            <div class="info__item">Материал: <span class="js-info-material"><%- toy.material %></span></div>
                            <!-- description закардкожено для демки -->
                            <div class="info__description js-info-description">Описание для данного товара отсутствует</div>
                            <div class="info__price">Цена: <span class="js-info-price"><%- toy.price %></span> руб.</div>
                        </div>
                        <input type="text" class="form-control phone js-phone" placeholder="Введите ваш номер">
                        <div class="info__item info__item_error">Ошибка: <span class="js-error-phone">Номер телефона введен некорректно</span></div>
                        <div class="btn btn-warning js-send-order">Заказать</div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Закрыть</button>
            </div>
        </div>
    </div>
</script>

<script type="text/template" id="toys-template">
    <% _.each(data, function(toy) { %>
        <div class="toy col-md-4 col-sm-6">
            <div class="toy-info">
                <div class="toy-info__code">Артикул: <span class="js-toy-code"><%- toy.articul %></span></div>
                <div class="toy-info__name"><%- toy.name %></div>
            </div>
            <div class="toy-img-wrapper">
                <img src="publick/i/<%- toy.img %>" class="toy__image img-thumbnail" alt="toy"/>
                <div class="col-md-4 col-sm-6 toy-more">
                    <div class="toy-more__text js-readmore btn btn-danger btn-xs" data-target="#order-modal">подробнее</div>
                </div>
            </div>
            <div class="toy__price">Цена: <b><span class="js-toy-price"><%- toy.price %></span> руб.</b></div>
            <div class="btn btn-sm btn-warning js-order">Заказать</div>
        </div>
    <% }) %>
</script>

<script type="text/template" id="popup-template">

</script>


<script src="publick/vendor/bower_components/jquery/jquery.min.js"></script>
<script src="publick/vendor/js/less-1.3.3.min.js"></script>
<script src="publick/vendor/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="publick/vendor/bower_components/underscore/underscore-min.js"></script>
<script src="publick/vendor/bower_components/backbone/backbone-min.js"></script>
<script src="publick/vendor/js/jquery.maskedinput.min.js"></script>
<script src="publick/js/app.js"></script>

<script>

    var toysTemplate = _.template( $('#toys-template').html() ),
        toyTemplate = _.template( $('#toy-template').html() ),
        submitTemplate = _.template( $('#submit-template').html() ),
        vent = {},
        data = [],
        toy = {},
        order = {},

        bearsData = [{"articul":"00001","name":"Мишка-братишка","img":"cat.jpg","price":"1000"},{"articul":"00002","name":"Мишка-топтыжка","img":"cat.jpg","price":"1010"},{"articul":"00003","name":"Мишка-юрист","img":"cat.jpg","price":"2000"},{"articul":"00004","name":"Мишка-малой","img":"cat.jpg","price":"999"},{"articul":"00005","name":"Мишка-большой-братишка","img":"cat.jpg","price":"1000"},{"articul":"00006","name":"Мишка длинное название","img":"cat.jpg","price":"1010"},{"articul":"00007","name":"Мишка-эффективный","img":"cat.jpg","price":"1029"},{"articul":"00008","name":"Мишка-лень","img":"cat.jpg","price":"1001"}],

        minionData = [{"articul":"10001","name":"Миньон-братишка","img":"dog.jpg","price":"1000"},{"articul":"10002","name":"Миньон-топтыжка","img":"dog.jpg","price":"1010"},{"articul":"10003","name":"Миньон-юрист","img":"dog.jpg","price":"2000"},{"articul":"10004","name":"Миньон-малой","img":"dog.jpg","price":"999"},{"articul":"10005","name":"Миньон-большой-братишка","img":"dog.jpg","price":"1000"},{"articul":"10006","name":"Миньон длинное название","img":"dog.jpg","price":"1010"},{"articul":"10007","name":"Миньон-эффективный","img":"dog.jpg","price":"1029"},{"articul":"10008","name":"Миньон-лень","img":"dog.jpg","price":"1001"}];

    _.extend(vent, Backbone.Events);

    vent.on('modal:open', function(model) {
        var modalView = new ModalView({
            model: model
        });
        modalView.render();
        $('#order-modal').modal('toggle');
    });

    // загружаем картинки при заходе в первый таб
    data = bearsData;
    $('.toys').html( toysTemplate(bearsData) );

    $('.js-tab').on('click',function (e) {
        var currentData = $(this).attr('href').slice(1);
        switch (currentData) {
            case 'bear':
                data = bearsData;
                $('.toys').html( toysTemplate(bearsData) );
            break;
            case 'minion':
                data = minionData;
                $('.toys').html( toysTemplate(minionData) );
            break;
        }
        e.preventDefault();
        $('.js-tab').removeClass('btn-border-black');
        $(e.currentTarget).addClass('btn-border-black');
        $(this).tab('show')
    });

    var ToyModel = Backbone.Model.extend({
        defaults: {
            price: 1000,
            material: 'шерсть'
        },
        initialize: function() {
            //vent.on('modal:open',this.render,this);
        },
        render: function() {
            console.log(this.attributes);
            $('#order-modal').modal('toggle');
        }
    });

    var ToyView = Backbone.View.extend({
        'el':'.toys',
        'events': {
            'click .js-readmore': 'openModal'
        },

        openModal: function(e) {
            var $parent = $(e.currentTarget).closest('.toy'),
                code = $('.js-toy-code',$parent).text(),
                name = $('.toy-info__name',$parent).text(),
                img = $('.toy__image',$parent).attr('src'),
                price = $('.js-toy-price',$parent).text();

            this.model.set({
                code: code,
                name: name,
                img: img,
                price: price
            });

            vent.trigger('modal:open', this.model);
        }
    });

    var ModalView = Backbone.View.extend({
        'events': {
            'click .js-send-order': 'submitOrder'
        },
        'el':'.js-popup',
        initialize: function() {
            console.log('modal view open');
            toy = {
                code: this.model.get('code'),
                name: this.model.get('name'),
                img: this.model.get('img'),
                price: this.model.get('price'),
                material: this.model.get('material')
            }
        },
        render: function() {
            this.$el.html( toyTemplate(toy) );
            this.$phone = this.$el.find(".js-phone");
            this.$phone.mask("+7 (999) 999-99-99");
        },
        submitOrder: function() {
            /*order.phone = this.$phone.val();
            debugger;
            if ( order.phone ) {
                this.$el.find('.info__item_error').fadeOut(200);
                this.$el.html( submitTemplate(order) );
            } else {
                this.$el.find('.info__item_error').fadeIn(200);
            }*/
            console.log('qq');
        }
    });

    var toyView = new ToyView({
        model: new ToyModel()
    });

</script>

</body>
</html>
